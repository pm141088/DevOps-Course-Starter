services:
- docker

before_script:
  - docker build --target test --tag test .

script:
  - docker run test tests
  - docker run test integration_tests
  - >
    docker run
    -e TRELLO_API_BASE_URL
    -e TRELLO_API_KEY
    -e TRELLO_API_TOKEN
    -e TRELLO_BOARD_ID
    test tests_e2e